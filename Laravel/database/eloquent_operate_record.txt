https://readouble.com/laravel/9.x/ja/eloquent.html



ğŸŸ¡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ“ä½œ


ğŸ”µæ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ç™»éŒ²

ğŸŸ¢save()
è¿”ã‚Šå€¤ï¼šä¿å­˜ã®æˆåŠŸã§trueãƒ»å¤±æ•—ã§false

ğŸŸ¢create()
è¤‡æ•°ã®ã‚«ãƒ©ãƒ ã®å€¤ã‚’ä¸€åº¦ã«è¨­å®šï¼ˆè¤‡æ•°ä»£å…¥ï¼‰ã§ãã‚‹ã€‚
è¿”ã‚Šå€¤ï¼šä½œæˆã—ãŸãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
â‡’fillableãƒ»guardedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ğŸŸ¢æ¤œç´¢ã—ã¦ãªã‘ã‚Œã°æ–°è¦ä½œæˆãƒ»ç”Ÿæˆ
firstOrCreateãƒ»firstOrNewï¼šåˆ¥é …å‚ç…§



ğŸ”µæ›´æ–°

ğŸŸ¢save()
è¿”ã‚Šå€¤ï¼šä¿å­˜ã®æˆåŠŸã§trueãƒ»å¤±æ•—ã§false

ğŸŸ¢ä¸€æ‹¬æ›´æ–°
â—Eloquentã§ä¸€æ‹¬æ›´æ–°ã™ã‚‹ã¨ãã€ãƒ¢ãƒ‡ãƒ«ãŒå®Ÿéš›ã«å–å¾—ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ãŸã‚ã€
ã€€savingã€savedã€updatingã€updatedãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãªã„ã€‚

update()
é©ç”¨ã—ãŸã™ã¹ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬ã§æ›´æ–°ã™ã‚‹ã€‚
è¿”ã‚Šå€¤ï¼šæ›´æ–°ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ•°

ğŸŸ¢ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°æ›´æ–°ã€ãªã‘ã‚Œã°æ–°è¦ä½œæˆ

ãƒ¼ã€€ï¼‘ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿
updateOrCreate
ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹æ™‚ã«ã€å¯¾è±¡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ã¨ãæ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ

ç¬¬ï¼‘å¼•æ•°ï¼šãƒ¬ã‚³ãƒ¼ãƒ‰ã®æŒ‡å®šï¼ˆå¯¾è±¡ã¨ãªã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒæŒã¤ã‚«ãƒ©ãƒ ã¨å€¤ã‚’æŒ‡å®šï¼‰
ç¬¬ï¼’å¼•æ•°ï¼šæ›´æ–°ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’å€¤ã‚’æŒ‡å®š
ä¾‹ï¼‰
$flight = Flight::updateOrCreate(
    ['departure' => 'Oakland', 'destination' => 'San Diego'],
    ['price' => 99, 'discounted' => 1]
);

ãƒ¼ã€€è¤‡æ•°ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ‹¬
upsert()

ï¼Šå¼•æ•°ã¯ã™ã¹ã¦é…åˆ—ã§æŒ‡å®šã™ã‚‹â‡’è¤‡æ•°æŒ‡å®šã§ãã‚‹
ç¬¬ï¼‘å¼•æ•°ï¼šæ›´æ–°oræ–°è¦ä½œæˆã™ã‚‹ã‚«ãƒ©ãƒ ã¨å€¤ã‚’æŒ‡å®š
ç¬¬ï¼’å¼•æ•°ï¼šidã‚«ãƒ©ãƒ ï¼ˆãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸€æ„ã«è­˜åˆ¥ã§ãã‚‹ã‚«ãƒ©ãƒ ï¼‰
ç¬¬ï¼“å¼•æ•°ï¼šæ›´æ–°ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’æŒ‡å®š

$data = [
    ['id' => 1,'departure' => 'Oakland', 'destination' => 'San Diego', 'price' => 99],
    ['id' => 2,'departure' => 'Chicago', 'destination' => 'New York', 'price' => 150]
]
Flight::upsert($data, ['id'], ['price']);



ğŸ”µè¤‡æ•°ä»£å…¥ï¼ˆè¤‡æ•°ã®å±æ€§å€¤ã‚’ã¾ã¨ã‚ã¦ã‚»ãƒƒãƒˆã™ã‚‹ï¼‰
ï¼Šfillableã¨guardedãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã™ã‚‹å¿…è¦ã‚ã‚Š

ğŸŸ¢fill
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦è¤‡æ•°ä»£å…¥ã™ã‚‹
ä¾‹ï¼‰$flight->fill(['name' => 'Amsterdam', number => '400']);

ğŸŸ¢create()
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã€è¤‡æ•°ä»£å…¥ã€ä¿å­˜ã®ã™ã¹ã¦ãŒã§ãã‚‹ã€‚

ğŸŸ¢ã™ã¹ã¦ã®è¤‡æ•°ä»£å…¥ã‚’å¯èƒ½ã«ã™ã‚‹
protected $guarded = [];
â—ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å•é¡Œã‚ã‚Š

ğŸŸ¢è¨±å¯ã—ã¦ã„ãªã„ä»£å…¥ãŒã‚ã£ãŸã¨ãã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹
å‚ç…§ï¼šeloquent.txtã€ŒğŸ”µãƒã‚°ã‚’æœªç„¶ã«é˜²ãã€

ï¼ŠJSONã‚«ãƒ©ãƒ ï¼šã‚¬ã‚¤ãƒ‰ã€Œä¸€æ‹¬å‰²ã‚Šå½“ã¦ã¨JSONã‚«ãƒ©ãƒ ã€



ğŸ”µãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’DBã®ãƒ‡ãƒ¼ã‚¿ã¨åŒæœŸã•ã›ã‚‹ï¼ˆæœ€æ–°ã«ã™ã‚‹ï¼‰
DBãƒ‡ãƒ¼ã‚¿ã‚’æ“ä½œã™ã‚‹å‡¦ç†ã‚’ã—ãŸã¨ãã€ãã®ã¨ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨å®Ÿéš›ã®DBã®ãƒ‡ãƒ¼ã‚¿ãŒç•°ãªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚

ä¾‹ï¼‰åŒæœŸãŒå¿…è¦ã«ãªã‚‹ã¨ã
$post = Post::make();
$post->title = 'foo';
$post->save();

$comment = Comment::make();
$comment->comment = 'bar';

$post->comments()->save($comment);

$post->comments;ã€€ç©ºã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãŒè¿”ã£ã¦ãã‚‹

ğŸŸ¢flesh
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ï¼ˆçµã‚Šè¾¼ã¿ãªã©ï¼‰ã‚’ç¶­æŒã—ãŸã¾ã¾ã€DBã‹ã‚‰æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã™ã‚‹ï¼ˆæœ€æ–°ã®çŠ¶æ…‹ã«ãªã£ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
ï¼Šã‚‚ã¨ã‚‚ã¨ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¨ã¯åˆ¥ç‰©ã§ã€ã‚‚ã¨ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯åŒæœŸã•ã‚Œãªã„ã¾ã¾

ä¾‹ï¼‰
$flight = Flight::where('number', '900')->first();

// DBãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã™ã‚‹å‡¦ç†Aã‚’è¡Œã†

$freshFlight = $flight->fresh();ã€€AãŒåæ˜ ã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ï¼ˆwhere('number', '900')->first()ã®çµã‚Šè¾¼ã¿ã‚‚æ®‹ã‚‹ï¼‰
$flightã€€Aã¯ä¾ç„¶åæ˜ ã•ã‚Œã¦ã„ãªã„

ğŸŸ¢reflesh
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è‡ªä½“ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«æ›´æ–°ã™ã‚‹ã€‚ï¼ˆãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°ã•ã‚Œã‚‹ã€‚ï¼‰

ä¾‹ï¼‰
$flight = Flight::where('number', '900')->first();

$flight->number = '400';
$flight->number;ã€€400ãŒè¿”ã£ã¦ãã‚‹

$flight->refresh();

$flight->number;ã€€900ãŒè¿”ã£ã¦ãã‚‹



ğŸ”µå¤‰æ›´ã®æœ‰ç„¡ã‚’åˆ¤å®š

ğŸŸ¢ä¿å­˜å‰ã®å¤‰æ›´
isDirty()
ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—å¾Œã«ã€å±æ€§ãŒå¤‰æ›´ã•ã‚ŒãŸã‹ã‚’åˆ¤å®šã€‚

isClean()
ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—å¾Œã€å±æ€§ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’åˆ¤å®šã€‚

ä¾‹ï¼‰
$user = User::create([
    'first_name' => 'Taylor',
    'title' => 'Developer',
]);

$user->title = 'Painter';

$user->isDirty(); // true
$user->isClean(); // false

$user->isDirty('title'); // true
$user->isDirty('first_name'); // false
$user->isDirty(['first_name', 'title']); // trueã€€ã„ãšã‚Œã‹ã®å±æ€§ã«å¤‰æ›´ãŒã‚ã£ãŸã‹ã‚’åˆ¤å®šã§ãã¾ã™

ğŸŸ¢ä¿å­˜å¾Œã®å¤‰æ›´
wasChanged()
ç¾åœ¨ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚¯ãƒ«å†…ã§ã€ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®æœ€å¾Œã®ä¿å­˜æ™‚ã«å±æ€§ã«å¤‰æ›´ãŒèµ·ããŸã‹ã‚’åˆ¤åˆ¥ã™ã‚‹ã€‚

ä¾‹ï¼‰
$user = User::create([
    'title' => 'Developer',
    ///
]);

$user->title = 'Painter';
$user->save();

$user->wasChanged(); // true
$user->wasChanged('title'); // true



ğŸ”µå±æ€§ã®å¤‰æ›´ãƒ»ä¿å­˜å‰ã®å€¤ã‚’å–å¾—ã™ã‚‹
getOriginal()
å±æ€§ã®å¤‰æ›´ã‚„ã€ä¿å­˜ãŒå®Ÿè¡Œã•ã‚ŒãŸå¾Œã§ã‚‚ã€ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã—ãŸæ™‚ç‚¹ã®å€¤ã‚’å–å¾—ã§ãã‚‹ã€‚

ä¾‹ï¼‰
$user = User::find(1);
$user->name; // John
$user->name = "Jack";  ã“ã“ã§$user->save();ã‚’å®Ÿè¡Œã—ã¦ã‚‚åŒã˜ãJohnã‚’è¿”ã™

$user->getOriginal('name'); // John
$user->getOriginal(); // å…ƒã®å±æ€§ã®é…åˆ—



ğŸ”µå‰Šé™¤

ğŸŸ¢å‰Šé™¤ãƒ¡ã‚½ãƒƒãƒ‰
ãƒ¼ã€€delete()
ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤ã™ã‚‹

$flight = Flight::find(1);
$flight->delete();

Flight::where('active', 0)->delete(); *ã“ã®ã¨ãã€deletingãŠã‚ˆã³deletedãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆãŒãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã•ã‚Œãªã„

ãƒ¼ã€€destroy()
å¼•æ•°ã®idã‚’æŒã¤ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã™ã‚‹ã€‚

Flight::destroy(1);
Flight::destroy(1, 2, 3);
Flight::destroy([1, 2, 3]);
Flight::destroy(collect([1, 2, 3]));

ãƒ¼ã€€truncate()
ãƒ¢ãƒ‡ãƒ«ã®ã™ã¹ã¦ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã€è‡ªå‹•å¢—åˆ†IDã‚‚ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã€‚

Flight::truncate();

ğŸŸ¢ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆ
ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
â‡’å®Ÿéš›ã«DBã‹ã‚‰ã¯å‰Šé™¤ã•ã‚Œãšã€deleted_atã‚«ãƒ©ãƒ ã«å‰Šé™¤æ“ä½œã—ãŸæ—¥æ™‚ãŒä¿å­˜ã•ã‚Œã‚‹ã€‚

ãƒ¼ã€€ä½¿ã„æ–¹
ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã«deleted_atã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãæ–¹ï¼šã‚¬ã‚¤ãƒ‰ã€Œã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã€ï¼‰
ãƒ»Illuminate\Database\Eloquent\SoftDeletesãƒˆãƒ¬ã‚¤ãƒˆã‚’ãƒ¢ãƒ‡ãƒ«ã«è¿½åŠ ã™ã‚‹ã€‚

ãƒ¼ã€€ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰
ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªçµæœã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹ã€‚

ãƒ¼ã€€ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹
trashed()

if ($flight->trashed()) { // }

ãƒ¼ã€€å¾©å…ƒã™ã‚‹
restore()
ã‚¬ã‚¤ãƒ‰ã€Œã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã—ãŸãƒ¢ãƒ‡ãƒ«ã®å¾©å…ƒã€

ãƒ¼ã€€å®Œå…¨ãªå‰Šé™¤
forceDelete()
ã‚¬ã‚¤ãƒ‰ã€Œãƒ¢ãƒ‡ãƒ«ã®å®Œå…¨ãªå‰Šé™¤ã€

ãƒ¼ã€€ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚ã‚‹
withTrashed()
ã‚¬ã‚¤ãƒ‰ã€Œã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’å«ã‚ã‚‹ã€

ãƒ¼ã€€ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å–å¾—ã™ã‚‹
onlyTrashed()








ãƒ¢ãƒ‡ãƒ«ã®updated_atã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å¤‰æ›´ã›ãšã«ã€ãƒ¢ãƒ‡ãƒ«æ“ä½œã‚’è¡Œã„ãŸã„å ´åˆã¯ã€withoutTimestampsãƒ¡ã‚½ãƒƒãƒ‰ã¸æŒ‡å®šã™ã‚‹ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å†…ã§ã€ãã®ãƒ¢ãƒ‡ãƒ«ã‚’æ“ä½œã§ãã¾ã™ã€‚

Model::withoutTimestamps(fn () => $post->increment(['reads']));

