https://readouble.com/laravel/9.x/ja/eloquent.html



ğŸŸ¡Eloquentã®ãƒ¡ã‚½ãƒƒãƒ‰
Eloquentã¯ã€ãƒ¢ãƒ‡ãƒ«ã¨é–¢é€£ä»˜ã‘ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã¨ã—ã¦ã®æ©Ÿèƒ½ã‚‚æä¾›ã—ã¦ã„ã‚‹ã€‚

ä½¿ç”¨ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯Illuminate\Database\Eloquent\Builderã‚¯ãƒ©ã‚¹ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã€‚

ãƒ¼ã€€Query\Builderã‚¯ãƒ©ã‚¹ã¨ã®é•ã„
Illuminate\Database\Query\Builderã‚¯ãƒ©ã‚¹ï¼šãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã‚’æ§‹ç¯‰ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›

â‡’Query\Builderã‚¯ãƒ©ã‚¹ã‚’Eloquentç”¨ã«æ‹¡å¼µã—ãŸã®ãŒIlluminate\Database\Eloquent\Builderã‚¯ãƒ©ã‚¹ï¼šEloquentãƒ¢ãƒ‡ãƒ«ã¨é–¢é€£ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æä¾›
â‡’Query\Builderã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€Eloquentã«ã‚‚ä½¿ç”¨ã§ãã‚‹ã€‚

ï¼Šã“ã“ã§ã¯Eloquentã®ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‚’ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã¨å‘¼ã¶ã€‚



ğŸŸ¡ãƒ¡ã‚½ãƒƒãƒ‰ã¾ã¨ã‚
ï¼ŠDBãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ã®ä½¿ç”¨ã¯ä¸è¦ãƒ»ãƒ»ãƒ»Eloquentãƒ¢ãƒ‡ãƒ«ã«å¯¾ã—ã¦ã€é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

ï¼Šã™ã¹ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰
https://laravel.com/api/9.x/Illuminate/Database/Eloquent/Builder.html#method_where

ï¼ŠQuery\Builderã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒã˜çµæœãŒå¾—ã‚‰ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯çœç•¥

â‘ Eloquentã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‚’è¿”ã™

â‘¡Eloquentã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿”ã™

â‘¢Eloquentãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™



ğŸ”µâ‘ Eloquentã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‚’è¿”ã™
ï¼Šã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‚’å–å¾—ã—ã¦ã„ã‚‹æ™‚ç‚¹ã§ã¯ã€ã‚¯ã‚¨ãƒªã¯ç™ºè¡Œã•ã‚Œã¦ã„ãªã„ã€‚

ğŸŸ¢ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ ã®è¿½åŠ ãƒ»å–å¾—ã™ã‚‹ã‚«ãƒ©ãƒ ã®è¿½åŠ 
addSelect

ãƒ¼ã€€ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ ã‚’è¿½åŠ 
ä»»æ„ã®ã‚«ãƒ©ãƒ åã‚’æŒ‡å®šã—ã€ã‚µãƒ–ã‚¯ã‚¨ãƒªã®çµæœã‚’ã‚«ãƒ©ãƒ ã®å€¤ã¨ã—ã¦ã€ã‚¯ã‚¨ãƒªã®çµæœã«è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

ä¾‹ï¼‰destinationsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€last_flightã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã¦ã€ã‚µãƒ–ã‚¯ã‚¨ãƒªã®çµæœã‚’ãã®å€¤ã«è¨­å®šã™ã‚‹ã€‚
$destinations = Destination::addSelect(['last_flight' => Flight::select('name')
    ->whereColumn('destination_id', 'destinations.id')
    ->orderByDesc('arrived_at')
    ->limit(1)ã€€ã€€ç›®çš„åœ°ã§æ¤œç´¢ã—ã€åˆ°ç€æ™‚åˆ»ï¼ˆarrived_atï¼‰ãŒæœ€æ–°ã§ã€ãƒ•ãƒ©ã‚¤ãƒˆåã®ã¿ã‚’ã‚«ãƒ©ãƒ ã«ã‚‚ã¤ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ï¼‘ã¤è¿”ã™
])->get();

$destinations = [
    {
        "id": 1,
        "name": "Tokyo",
        "created_at": "2024-02-12 10:00:00",
        "updated_at": "2024-02-12 10:00:00",
        "last_flight": "Flight 123"ã€€ã€€ç›®çš„åœ°ãŒTokyoã§ã€æœ€æ–°ã®åˆ°ç€æ™‚åˆ»ã®ãƒ•ãƒ©ã‚¤ãƒˆåãŒã“ã“ã«å…¥ã‚‹
    },
ã€€ã€€///
]

ãƒ¼ã€€å­˜åœ¨ã™ã‚‹ã‚«ãƒ©ãƒ ã‚’æŒ‡å®šã™ã‚‹
ã™ã§ã«selectã•ã‚ŒãŸã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã«ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã™ã‚‹

ğŸŸ¢ã‚µãƒ–ã‚¯ã‚¨ãƒªã®çµæœã§ä¸¦ã¹æ›¿ãˆ
orderBy()ã«ã‚µãƒ–ã‚¯ã‚¨ãƒªã‚’æ¸¡ã—ãŸã¨ã
â‡’ã‚µãƒ–ã‚¯ã‚¨ãƒªã®çµæœé †ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã¹æ›¿ãˆã‚‹ã€‚

ä¾‹ï¼‰åˆ°ç€æ™‚åˆ»ï¼ˆarrived_atï¼‰ãŒæ—©ã„é †ã«destinationsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä¸¦ã¹æ›¿ãˆã‚‹ã€‚
Destination::orderByDesc(
    Flight::select('arrived_at')
        ->whereColumn('destination_id', 'destinations.id')
        ->orderByDesc('arrived_at')
        ->limit(1)
)->get();



ğŸ”µâ‘¡Eloquentã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿”ã™
ï¼Šã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã‹ã‚‰ã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ãŸæ™‚ç‚¹ã§ã€ã‚¯ã‚¨ãƒªãŒç™ºè¡Œã•ã‚Œã‚‹ã€‚



ğŸ”µâ‘¢Eloquentãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™

ğŸŸ¢firstWhere()
whereã¨firstã‚’ä½µç”¨ã—ãŸã®ã¨åŒã˜çµæœã‚’å¾—ã‚‹ã€‚
$flight = Flight::where('active', 1)->first();

ğŸŸ¢çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹
çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã€ä¾‹å¤–ï¼ˆIlluminate\Database\Eloquent\ModelNotFoundExceptionï¼‰ã‚’æŠ•ã’ã‚‹ã€‚
ï¼ŠModelNotFoundExceptionã‚’ã‚­ãƒ£ãƒƒãƒã—ãªã„å ´åˆã¯ã€404ã‚’è¿”ã™ã€‚

ãƒ¼ã€€findOrFail()
$flight = Flight::findOrFail(1);

ãƒ¼ã€€firstOrFail()
$flight = Flight::where('legs', '>', 3)->firstOrFail();

ğŸŸ¢çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã®å‡¦ç†ã‚’æŒ‡å®šã™ã‚‹
çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã§æŒ‡å®šã—ãŸå‡¦ç†ã‚’å®Ÿè¡Œã—ã€ãã®è¿”ã‚Šå€¤ãŒçµæœã¨ãªã‚‹ã€‚

ãƒ¼ã€€findOr()
$flight = Flight::findOr(1, function () {
    // ...
});

ãƒ¼ã€€firstOr()
$flight = Flight::where('legs', '>', 3)->firstOr(function () {
    // ...
});

ğŸŸ¢çµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆ / ç”Ÿæˆã™ã‚‹
ç¬¬ï¼‘å¼•æ•°ï¼šæ¤œç´¢ã—ãŸã„æ¡ä»¶ã‚’é…åˆ—ã§æŒ‡å®šã™ã‚‹
ç¬¬ï¼’å¼•æ•°ï¼šçµæœãŒå¾—ã‚‰ã‚Œãªã‹ã£ãŸã¨ãã«ä½œæˆ/ç”Ÿæˆã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å±æ€§ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã§æŒ‡å®šã™ã‚‹

ãƒ¼ã€€ä½œæˆã™ã‚‹
firstOrCreate()

ä¾‹ï¼‰nameã‚«ãƒ©ãƒ ãŒLondonã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã€ãªã‘ã‚Œã°nameã‚«ãƒ©ãƒ ã®å€¤ãŒLondonã«è¨­å®šã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹
$flight = Flight::firstOrCreate([
    'name' => 'London'
]);

ä¾‹ï¼‰nameã‚«ãƒ©ãƒ ãŒLondonã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã€ãªã‘ã‚Œã°nameã€delayedã€delayedã‚«ãƒ©ãƒ ã«æŒ‡å®šã®å€¤ãŒè¨­å®šã•ã‚ŒãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã™ã‚‹
$flight = Flight::firstOrCreate(
    ['name' => 'London to Paris'],
    ['delayed' => 1, 'arrival_time' => '11:30']
);

ãƒ¼ã€€ç”Ÿæˆã™ã‚‹
firstOrNew()

DBã«ã¯ä¿å­˜ã•ã‚Œãšã€æŒ‡å®šã®å±æ€§ãƒ‡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚ŒãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ã€‚
â‡’ä¿å­˜ã™ã‚‹å ´åˆã¯ã€save()ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

ä¾‹ï¼‰ä½¿ç”¨æ–¹æ³•ã¯ä¸Šè¨˜ã¨åŒã˜



ğŸ”µåŒã˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‹ã®åˆ¤å®š

is()ãƒ»isNot()
2ã¤ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒåŒã˜ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã™ã‚‹ã€‚
â‡’åŒã˜ãƒ†ãƒ¼ãƒ–ãƒ«ã€åŒã˜idã€åŒã˜DBæ¥ç¶šã‚’ã—ã¦ã„ã‚‹å ´åˆã«true/falseã‚’è¿”ã™ã€‚

ä¾‹ï¼‰
$user1 = User::find(1);
$user2 = User::find(2);
$user3 = User::find(1);

$user1->is($user3); // true
