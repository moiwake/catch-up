https://readouble.com/laravel/9.x/ja/eloquent-relationships.html
ã€Œãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ã‚¨ãƒªã€



ğŸŸ¡ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¯ã‚¨ãƒªæ“ä½œ

ğŸ”µãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä½¿ã„åˆ†ã‘

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è¦³ç‚¹ã‹ã‚‰ã€ä½¿ã„åˆ†ã‘ãŒå¿…è¦ã«ãªã‚‹ã€‚

ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ï¼š()ã‚ã‚Šã€€ãƒ»ãƒ»ãƒ»post()
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼š()ãªã—ã€€ãƒ»ãƒ»ãƒ»post

ãƒ¼ã€€è¿”ã‚Šå€¤ã®é•ã„
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ï¼šIlluminate\Database\Eloquent\Relations\HasManyã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼šIlluminate\Database\Eloquent\Collectionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

ãƒ¼ã€€èª­ã¿è¾¼ã¿ã®é•ã„
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ï¼šé…å»¶èª­ã¿è¾¼ã¿ï¼ˆLazy loadingï¼‰â‡’ã€€N+1ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼šå³æ™‚èª­ã¿è¾¼ã¿ï¼ˆEager loadingï¼‰

ğŸŸ¢åˆ¶ç´„ã‚’è¿½åŠ ã™ã‚‹ã¨ãï¼ˆã‚¯ã‚¨ãƒªãƒ¡ã‚½ãƒƒãƒ‰ã‚’ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹ã¨ãï¼‰
ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹

ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ãƒã‚§ãƒ¼ãƒ³ã‚’ã™ã‚‹ã¨ã€ãã®æ™‚ç‚¹ã§é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ä»¶å–å¾—ã—ã¦ã—ã¾ã†ã€‚

ä¾‹ï¼‰
$user->posts->where('active', 1)->get();
â‡’$user->postsã®æ™‚ç‚¹ã§ã€è©²å½“ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚

$user->posts()->where('active', 1)->get();
â‡’$user->posts()ã®æ™‚ç‚¹ã§ã¯ã€ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å–å¾—ã¯è¡Œã‚ã‚Œãšã€getã®æ™‚ç‚¹ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚
â‡’å–å¾—ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ•°ãŒæ¸›ã‚‹ã€‚

ğŸŸ¢åˆ¶ç´„ã‚’è¿½åŠ ã—ãªã„ã¨ãï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã‚’ã—ãªã„ã¨ãï¼‰
$user->posts; ã¨ $user->posts()->get();
ã©ã£ã¡ãŒã„ã„ï¼Ÿï¼Ÿï¼Ÿ

ãŠãã‚‰ããƒ»ãƒ»ãƒ»
ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã¦ã€ãã‚Œã‚’è¿”ã™ã ã‘ã®å‡¦ç†ã ã£ãŸå ´åˆã¯ã€$user->posts;ã§ã‚‚å•é¡Œãªã„ã€‚
ã ãŒã€å„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¹°ã‚Šè¿”ã—ã®å‡¦ç†ãªã©ã§ä½¿ç”¨ã™ã‚‹å ´åˆã«ã¯$user->posts()->get();ã‚’ä½¿ã‚ãªã„ã¨N+1ã«ãªã‚‹ï¼Ÿï¼šè¦ç¢ºèª



ğŸ”µorWhere

â—ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«orWhereã‚’ãƒã‚§ãƒ¼ãƒ³ã™ã‚‹ã¨ãã®æ³¨æ„ç‚¹

orWhereã¯ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆ¶ç´„ã¨åŒã˜ãƒ¬ãƒ™ãƒ«ã§è«–ç†çš„ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚Œã‚‹
â‡’é–¢é€£ã—ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚‚ä¸€ç·’ã«å–å¾—ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

ãƒ¼ã€€é–¢é€£ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€ã•ã‚‰ã«ORæ¡ä»¶ã®åˆ¶ç´„ã‚’ä»˜ã‘ãŸã„ã¨ã

æ­£ã—ã„ï¼‰
$user->posts()
    ->where(function (Builder $query) {
        return $query->where('active', 1)
            ->orWhere('votes', '>=', 100);
    })
    ->get();

select *
from posts
where user_id = ? and (active = 1 or votes >= 100)

é–“é•ã„ï¼‰
$user->posts()
    ->where('active', 1)
    ->orWhere('votes', '>=', 100)
    ->get();

select *
from posts
where user_id = ? and active = 1 or votes >= 100  // votes >= 100ã®æ¡ä»¶ã‚’æº€ãŸã™Postã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã™ã¹ã¦å–å¾—ã•ã‚Œã‚‹



ğŸ”µå¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã¨é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Œã°å–å¾—

ğŸŸ¢é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹
has

æŒ‡å®šã®é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ä»¶å–å¾—ã™ã‚‹ã€‚

ä¾‹ï¼‰$posts = Post::has('comments')->get(); // Postã¨CommentãŒé–¢é€£ã—ã¦ã„ã‚‹ã¨ãã€Commentã¨ç´ã¥ã„ã¦ã„ã‚‹Postã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ä»¶å–å¾—ã™ã‚‹ã€‚

ãƒ¼ã€€ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæŒã£ã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã«åˆ¶ç´„ã‚’ã¤ã‘ã‚‹
å¼•æ•°ã«æ¼”ç®—å­ã¨ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’æŒ‡å®šã™ã‚‹ã€‚

ä¾‹ï¼‰$posts = Post::has('comments', '>=', 3)->get();

ãƒ¼ã€€ãƒã‚¹ãƒˆã—ãŸé–¢é€£ã§ã‚‚OK
å¼•æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«åã§ãƒ‰ãƒƒãƒˆè¨˜æ³•ã‚’ä½¿ã†

ä¾‹ï¼‰$posts = Post::has('comments.images')->get();
ã€€ã€€// Postã¨CommentãŒã€Commetã¨ImageãŒé–¢é€£ã—ã¦ã„ã‚‹ã¨ãã€Imageã¨ç´ã¥ãCommentãŒç´ã¥ã„ã¦ã„ã‚‹Postã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å…¨ä»¶å–å¾—ã™ã‚‹ã€‚

ğŸŸ¢é–¢é€£å…ˆã«å˜ç´”ãªï¼‘æ¡ä»¶ã‚’ã¤ã‘ã‚‹
whereRelationã€orWhereRelationã€
whereMorphRelationã€orWhereMorphRelation

é–¢é€£å…ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢ã—ã¦ã€ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ç´ã¥ããƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚

ä¾‹ï¼‰Commentã®æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ç´ã¥ãPostã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚
$posts = Post::whereRelation(
    'comments', 'created_at', '>=', now()->subHour()
)->get();

ğŸŸ¢é–¢é€£å…ˆã«è¤‡é›‘ãªæ¡ä»¶ã‚’ã¤ã‘ã‚‹
whereHasãƒ»orWhereHas

é–¢é€£å…ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢ã—ã¦ã€ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ç´ã¥ããƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚

ä¾‹ï¼‰commentsãƒ†ãƒ¼ãƒ–ãƒ«ã®contentã‚«ãƒ©ãƒ ã‚’æ¤œç´¢ã—ã¦ã€è©²å½“ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ï¼‘ï¼ä»¶ä»¥ä¸Šç´ã¥ã„ã¦ã„ã‚‹Postã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
$posts = Post::whereHas('comments', function (Builder $query) {
    $query->where('content', 'like', 'code%');ã€€// é–¢é€£å…ˆã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢
}, '>=', 10)->get();



ğŸ”µå¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã¨é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã‚Œã°å–å¾—

ğŸŸ¢é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒãªã„
doesntHave
ï¼Šä½¿ç”¨æ–¹æ³•ã¯hasã¨åŒã˜

ğŸŸ¢é–¢é€£å…ˆã«è¤‡é›‘ãªæ¡ä»¶ã‚’ã¤ã‘ã‚‹
whereDoesntHaveã€orWhereDoesntHave
ï¼Šä½¿ç”¨æ–¹æ³•ã¯whereHasãƒ»orWhereHasã¨åŒã˜



ğŸ”µãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£

ğŸŸ¢é–¢é€£å…ˆã‚’æ¤œç´¢ã—ã€ç´ã¥ã/ç´ã¥ã‹ãªã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
whereHasMorphã€whereDoesntHaveMorph

ç¬¬ï¼‘å¼•æ•°ï¼šãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å
ç¬¬ï¼’å¼•æ•°ï¼šæ¤œç´¢ã™ã‚‹ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã®ãƒ¢ãƒ‡ãƒ«å
ç¬¬ï¼“å¼•æ•°ï¼šé–¢é€£å…ˆã®ã‚¯ã‚¨ãƒªã‚’æ¤œç´¢ã™ã‚‹ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼

ä¾‹ï¼‰ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®æ¡ä»¶ã«è©²å½“ã™ã‚‹Postã€Videoã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ç´ã¥ãCommentã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚
$comments = Comment::whereHasMorph(
    'commentable',
    [Post::class, Video::class],
    function (Builder $query) {
        $query->where('title', 'like', 'code%');  // ã“ã®æ¤œç´¢çµæœã®ã‚¯ã‚¨ãƒªã¨ç´ã¥ãCommentã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
    }
)->get();

ãƒ¼ã€€æ¤œç´¢å¯¾è±¡ã«ã™ã‚‹ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã®ãƒ¢ãƒ‡ãƒ«ã‚’ã€Œå…¨ã¦ã€ã«ã™ã‚‹
ç¬¬ï¼’å¼•æ•°ã®é…åˆ—ã‚’ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã€Œ'*'ã€ã«ã™ã‚‹ã€‚

ï¼Šã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«è¿½åŠ ã®ã‚¯ã‚¨ãƒªç™ºè¡ŒãŒã‚ã‚‹ï¼Ÿï¼Ÿ

ãƒ¼ã€€ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã‚’åˆ¶ç´„ã«è¿½åŠ ã—ãŸã„ã¨ã
ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®ç¬¬ï¼’å¼•æ•°ã¯ã€ã‚¿ã‚¤ãƒ—ã®å€¤ã‚’å—ã‘å–ã‚‹

ä¾‹ï¼‰
$comments = Comment::whereHasMorph(
    'commentable',
    [Post::class, Video::class],
    function (Builder $query, $type) {  // $typeã«ã¯ã€Postã‹Videoã®commentable_typeã‚«ãƒ©ãƒ ã®å€¤ãŒå…¥ã‚‹
        $column = $type === Post::class ? 'content' : 'title';

        $query->where($column, 'like', 'code%');
    }
)->get();



ğŸ”µé–¢é€£å…ˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’å–å¾—ã™ã‚‹
â—selectå¥ã¨ä½µç”¨ã™ã‚‹å ´åˆã¯ã€selectã®å¾Œã«ä½¿ç”¨ã™ã‚‹ã€‚

ğŸŸ¢å–å¾—å¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã®å–å¾—ã¨åŒæ™‚ã«
withCount
â‡’çµæœã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€ã€Œãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å_countã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ã€‚

ï¼Šå®Ÿéš›ã«é–¢é€£å…ˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰ã›ãšã«é›†è¨ˆã§ãã‚‹ï¼Ÿï¼Ÿ

ä¾‹ï¼‰
$posts = Post::withCount('comments')->get();

foreach ($posts as $post) {
    echo $post->comments_count;
}

ãƒ¼ã€€è¤‡æ•°ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®š
å¼•æ•°ã‚’é…åˆ—ã«ã—ã¦ã€è¤‡æ•°ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã§ãã‚‹ã€‚

ä¾‹ï¼‰$posts = Post::withCount(['votes', 'comments'])->get();

ãƒ¼ã€€é›†è¨ˆã™ã‚‹é–¢é€£ãƒ¢ãƒ‡ãƒ«ã«åˆ¶ç´„ã‚’ã¤ã‘ã‚‹
é…åˆ—å†…ã«ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’å…¥ã‚Œã‚‹ã€‚

ä¾‹ï¼‰
$posts = Post::withCount(['votes', 'comments' => function (Builder $query) {
    $query->where('content', 'like', 'code%');
}])->get();

echo $posts[0]->votes_count;
echo $posts[0]->comments_count;

ãƒ¼ã€€åŒã˜ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€åˆ¥æ¡ä»¶ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é›†è¨ˆã‚’ã™ã‚‹
åŒã˜ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚‚ã€åˆ¥åã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ã€æ¡ä»¶ã‚’å¤‰ãˆã¦é›†è¨ˆçµæœã‚’å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

$posts = Post::withCount([
    'comments',
    'comments as pending_comments_count' => function (Builder $query) {
        $query->where('approved', false);
    },
])->get();

echo $posts[0]->comments_count;  // é–¢é€£ã™ã‚‹Commentã®å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°
echo $posts[0]->pending_comments_count;  // é–¢é€£ã™ã‚‹Commentã®ã†ã¡ã€ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã®æ¡ä»¶ã«è©²å½“ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°

ğŸŸ¢å–å¾—å¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã®å–å¾—ã®å¾Œã«
loadCount
â‡’å¯¾è±¡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€Œãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å_countã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ã€‚

ä¾‹ï¼‰
$book = Book::first();
$book->loadCount('genres');

ï¼Šå¿œç”¨çš„ãªä½¿ç”¨æ–¹æ³•ã¯withCountã¨åŒã˜ï¼Ÿï¼Ÿ

ğŸŸ¢ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯ã®ã¨ã

ãƒ¼ã€€é–¢é€£ã™ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã®å–å¾—
withCountã§ã§ãã‚‹ï¼Ÿï¼Ÿ

ãƒ¼ã€€ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã€ã•ã‚‰ã«é–¢é€£ã—ã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ•°ã‚’å–å¾—ã™ã‚‹
morphWithCount
â—morphWithCountã¯ç›´æ¥ä½¿ç”¨ã™ã‚‹ã¨Eager Loadingã«ãªã‚‰ãªã„ãŸã‚ã€withãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ä½¿ç”¨ã—ãŸæ–¹ãŒè‰¯ã„ã€‚

ï¼Šå¿œç”¨çš„ãªä½¿ç”¨æ–¹æ³•ã¯withCountã¨åŒã˜ï¼Ÿï¼Ÿ

ä¾‹ï¼‰ActivityFeedã¯ã€Photoãƒ»Postãƒ¢ãƒ‡ãƒ«ã¨ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ã‚’æŒã£ã¦ã„ã‚‹
ã€€ã€€Photoã¯Tagãƒ¢ãƒ‡ãƒ«ã¨å¤šå¯¾å¤šã®é–¢é€£ã‚’ã‚‚ã¤
ã€€ã€€Postã¯Commentãƒ¢ãƒ‡ãƒ«ã¨å¤šå¯¾å¤šã®é–¢é€£ã‚’ã‚‚ã¤

$activities = ActivityFeed::with([
    'parentable' => function (MorphTo $morphTo) {
        $morphTo->morphWithCount([
            Photo::class => ['tags'],  // Tagã¨é–¢é€£ã™ã‚‹Photoã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’å–å¾—
            Post::class => ['comments'],  // Commentã¨é–¢é€£ã™ã‚‹Postã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’å–å¾—
        ]);
    }])->get();


loadMorphCount

ä¾‹ï¼‰
$activities = ActivityFeed::with('parentable')->get();

$activities->loadMorphCount('parentable', [
    Photo::class => ['tags'],
    Post::class => ['comments'],
]);



ğŸ”µé–¢é€£å…ˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã«é›†è¨ˆå‡¦ç†ã‚’ã—ã¦å–å¾—ã™ã‚‹
â—selectå¥ã¨ä½µç”¨ã™ã‚‹å ´åˆã¯ã€selectã®å¾Œã«ä½¿ç”¨ã™ã‚‹ã€‚

ğŸŸ¢å–å¾—å¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã®å–å¾—ã¨åŒæ™‚ã«
withMinã€withMaxã€withAvgã€withSumã€withExists
â‡’çµæœã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€ã€Œãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å_é›†è¨ˆæ©Ÿèƒ½å_columnã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ã€‚

ä¾‹ï¼‰
$posts = Post::withSum('comments', 'votes')->get();

foreach ($posts as $post) {
    echo $post->comments_sum_votes;
}

ãƒ¼ã€€è¿½åŠ ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã‚’æŒ‡å®šã™ã‚‹
ç¬¬ï¼‘å¼•æ•°ã«ã€Œas åˆ¥åã€ã‚’ä»˜ã‘ã‚‹

ä¾‹ï¼‰
$posts = Post::withSum('comments as total_comments', 'votes')->get();

foreach ($posts as $post) {
    echo $post->total_comments;
}

ğŸŸ¢å–å¾—å¯¾è±¡ãƒ¢ãƒ‡ãƒ«ã®å–å¾—ã®å¾Œã«
loadMinã€loadMaxã€loadAvgã€loadSumã€loadExists
â‡’å¯¾è±¡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ã€Œãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å_countã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã™ã‚‹ã€‚

ä¾‹ï¼‰
$post = Post::first();
$post->loadSum('comments', 'votes');

ï¼Šå¿œç”¨çš„ãªä½¿ç”¨æ–¹æ³•ã¯withSumãªã©ã¨åŒã˜ï¼Ÿï¼Ÿ
