https://readouble.com/laravel/9.x/ja/http-tests.html
ã€Œåˆ©ç”¨å¯èƒ½ãªã‚¢ã‚µãƒ¼ãƒˆã€

ä¸€è¦§
https://laravel.com/api/8.x/Illuminate/Testing/TestResponse.html


â€»JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯é…åˆ—ã«å¤‰æ›ã•ã‚Œã‚‹


ğŸŸ¡JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¸€è‡´

ğŸ”µéƒ¨åˆ†ä¸€è‡´ï¼ˆæŒ‡å®šã®é…åˆ—ãŒå­˜åœ¨ã™ã‚‹ã‹ï¼‰

ğŸŸ¢æ§‹é€ ã‚‚ãƒã‚§ãƒƒã‚¯ã™ã‚‹
assertJson
æŒ‡å®šã®é…åˆ—ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹

ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¦ã‚‚ãƒ‘ã‚¹ã™ã‚‹ã€‚
ãƒ»é…åˆ—ã®éšå±¤ãŒä¸€è‡´ã—ã¦ã„ãªã‘ã‚Œã°ãƒ‘ã‚¹ã—ãªã„ã€‚ï¼ˆãŸã¶ã‚“ï¼‰

ğŸŸ¢æ§‹é€ ã¯ãƒã‚§ãƒƒã‚¯ã—ãªã„
assertJsonFragment
æŒ‡å®šã®é…åˆ—ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…ã«å­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹

ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«ä»–ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã—ã¦ã‚‚ãƒ‘ã‚¹ã™ã‚‹ã€‚
ãƒ»é…åˆ—ã®éšå±¤ãŒä¸€è‡´ã—ã¦ã„ãªãã¦ã‚‚ãƒ‘ã‚¹ã™ã‚‹ã€‚



ğŸ”µå®Œå…¨ä¸€è‡´ï¼ˆæŒ‡å®šã®é…åˆ—ã¨åŒã˜ã‹ï¼‰
assertExactJson
æŒ‡å®šã®é…åˆ—ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒä¸€è‡´ã™ã‚‹ã‹

ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ ã¨ãã®å€¤ãŒå®Œå…¨ã«ä¸€è‡´ã—ã¦ã„ãªã„ã¨ãƒ‘ã‚¹ã—ãªã„ã€‚



ğŸ”µï¼‘ç®‡æ‰€ã®ã¿
assertJsonPath
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ã‚¹ã®å€¤ã¨ã€æŒ‡å®šã®å€¤ãŒä¸€è‡´ã™ã‚‹ã‹

ç¬¬ï¼‘å¼•æ•°ï¼šãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ã‚¹ï¼ˆãƒ‰ãƒƒãƒˆã§éšå±¤ã‚’æŒ‡å®šï¼‰
ç¬¬ï¼’å¼•æ•°ï¼šæœŸå¾…å€¤

ä¾‹ï¼‰
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ§‹é€ 
{
    "user": {
        "id": 1,
        "name": "John Doe",
        "profile": {
            "email": "john@example.com",
            "age": 30
        }
    }
}

$response->assertJsonPath('user.profile.email', 'john@example.com');

ğŸŸ¢ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã§åˆæ ¼ã®æ¡ä»¶ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹
ç¬¬ï¼’å¼•æ•°ã«ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ï¼štrue/falseã‚’è¿”ã™ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼
â‡’trueã®å ´åˆã«ã¯ãƒ‘ã‚¹ã™ã‚‹ã‚ˆã†ãªãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã‚‹

ä¾‹ï¼‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æŒ‡å®šã®ãƒ‘ã‚¹ã®å€¤ãŒã€ï¼“æ–‡å­—ä»¥ä¸Šã‹ã‚’æ¤œè¨¼ã™ã‚‹
$response->assertJsonPath('team.owner.name', fn ($name) => strlen($name) >= 3);
â‡’$nameã«ã¯'team.owner.name'ã®å€¤ãŒå…¥ã‚‹
â‡’$nameãŒï¼“æ–‡å­—ä»¥ä¸Šãªã‚‰ã°trueã‚’è¿”ã—ã€ãƒ‘ã‚¹ã™ã‚‹ã€‚




ğŸŸ¡ãã®ä»–ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹æ¤œè¨¼

ğŸ”µæŒ‡å®šã‚­ãƒ¼ã®è¦ç´ æ•°
assertJsonCount
â€»ã‚­ãƒ¼ã®æŒ‡å®šãŒãªã„ã¨ãã¯ã€æœ€ä¸Šä½ã®ãƒ¬ãƒ™ãƒ«ã®è¦ç´ æ•°ã‚’æ¤œè¨¼ã™ã‚‹

ä¾‹ï¼‰$response->assertJsonCount(3, 'users');



ğŸ”µã‚­ãƒ¼ã®æœ‰ç„¡ã¨ã€æ§‹é€ 
assertJsonStructure

ä¾‹ï¼‰
$response->assertJsonStructure([
    'user' => [
        '*' => [
            'name',
            'age',
            'location'
        ]
    ]
]);

ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
    "user": [
        {
            "name": "Steve Schoger",
            "age": 55,
            "location": "Earth"
        },
        {
            "name": "Mary Schoger",
            "age": 60,
            "location": "Earth"
        }
    ]
}



ğŸ”µã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
assertStatus(ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰)
assertSuccessfulï¼š200 ~ 299
assertOkï¼š200
assertCreatedï¼š201
assertUnauthorizedï¼š401
assertForbiddenï¼š403
assertNotFoundï¼š404
assertUnprocessableï¼š422



ğŸ”µãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ¼ã€€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹/ãªã„ï¼†ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¨ãƒ©ãƒ¼ãŒä¸€æ™‚ä¿å­˜ã•ã‚Œã¦ã„ã‚‹/ã„ãªã„
assertInvalid
assertValid

ä¾‹ï¼‰
$response->assertValid();
$response->assertValid(['name', 'email']);

$response->assertInvalid([
    'name' => 'The name field is required.',
    'email' => 'valid email address',
]);

ãƒ¼ã€€æŒ‡å®šã™ã‚‹ã‚­ãƒ¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹/ãªã„
assertJsonValidationErrors
assertJsonMissingValidationErrors



ğŸ”µãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã®URI

ãƒ¼ã€€æŒ‡å®šã—ãŸURIã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãŒæˆåŠŸã—ãŸã‹
$response->assertRedirect($uri);

â€»Locationãƒ˜ãƒƒãƒ€ã«æŒ‡å®šã™ã‚‹URIå€¤ãŒã‚ã‚‹ã‹ï¼ˆassertRedirectã®æ–¹ãŒã„ã„ã¨æ€ã†ï¼‰
assertLocation

ãƒ¼ã€€æŒ‡å®šã—ãŸåå‰ä»˜ããƒ«ãƒ¼ãƒˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ãŸã‹
$response->assertRedirectToRoute($name = null, $parameters = []);

ãƒ¼ã€€æŒ‡å®šç½²åä»˜ããƒ«ãƒ¼ãƒˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
$response->assertRedirectToSignedRoute($name = null, $parameters = []);

ãƒ¼ã€€æŒ‡å®šã—ãŸæ–‡å­—åˆ—ã‚’å«ã‚€URIã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
$response->assertRedirectContains($string);



ğŸ”µãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã¦ã„ãªã„

ãƒ¼ã€€éƒ¨åˆ†ä¸€è‡´
assertJsonMissing

ãƒ¼ã€€å®Œå…¨ä¸€è‡´
assertJsonMissingExact

ãƒ¼ã€€ï¼‘ç®‡æ‰€ã®ã¿
assertJsonMissingPath



ğŸ”µãƒ‡ãƒ¼ã‚¿å‹

ãƒ¼ã€€é…åˆ—ã‹
$response->assertJsonIsArray();

ãƒ¼ã€€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹
$response->assertJsonIsObject();



ğŸ”µãƒ˜ãƒƒãƒ€ãƒ¼
assertHeaderã€assertHeaderMissing



ğŸ”µæ–‡å­—åˆ—ã€€ã€€ã“ã‚Œä½•ï¼Ÿ
â€»ï¼’ç•ªç›®ã®å¼•æ•°ã«falseã‚’æ¸¡ã•ãªã„é™ã‚Šã€æŒ‡å®šã™ã‚‹æ–‡å­—åˆ—ã‚’è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹ã€‚

ãƒ¼ã€€æŒ‡å®šã™ã‚‹æ–‡å­—åˆ—/ãƒ†ã‚­ã‚¹ãƒˆãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
$response->assertSee($value, $escaped = true);
$response->assertSeeText($value, $escaped = true);

â€»å«ã¾ã‚Œã¦ã„ãªã„
assertDontSeeã€assertDontSeeText

ãƒ¼ã€€è¤‡æ•°ã®æ–‡å­—åˆ—ãŒé †ç•ªã«å«ã¾ã‚Œã‚‹
$response->assertSeeInOrder(array $values, $escaped = true);
$response->assertSeeTextInOrder(array $values, $escaped = true);

ãƒ¼ã€€æŒ‡å®šã—ãŸæ–‡å­—åˆ—ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å†…å®¹ã¨ä¸€è‡´ã™ã‚‹ã‹
$response->assertContent($value);

ãƒ¼ã€€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æŒ‡å®šã™ã‚‹HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚‹ï¼†ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒãªã„
$response->assertNoContent($status = 204);

ãƒ¼ã€€æŒ‡å®šæ–‡å­—åˆ—ãŒã‚¹ãƒˆãƒªãƒ¼ãƒ ã—ãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å†…å®¹ã«ä¸€è‡´ã™ã‚‹ã‹
$response->assertStreamedContent($value);





ğŸŸ¡èªè¨¼ã®æ¤œè¨¼

ãƒ¼ã€€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼æ¸ˆã¿ã‹/ã—ã¦ãªã„ã‹
$this->assertAuthenticated($guard = null);
$this->assertGuest($guard = null);

ãƒ¼ã€€ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼æ¸ˆã¿
$this->assertAuthenticatedAs($user, $guard = null);





ğŸŸ¡ã‚¯ãƒƒã‚­ãƒ¼ã®æ¤œè¨¼
assertCookie
assertCookieExpired
assertCookieNotExpired
assertCookieMissing

ãƒ¼ã€€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æŒ‡å®šã™ã‚‹æš—å·åŒ–ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒƒã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
$response->assertPlainCookie($cookieName, $value = null);





ğŸŸ¡ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ¤œè¨¼

ãƒ¼ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æŒ‡å®šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
$response->assertSessionHas($key, $value = null);

ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ç¬¬ï¼’å¼•æ•°ã«æ¸¡ã›ã‚‹ï¼ˆã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãŒtrueã‚’è¿”ã›ã°ã‚¢ã‚µãƒ¼ãƒˆã¯æˆåŠŸï¼‰

$response->assertSessionHas($key, function ($value) {
    return $value->name === 'Taylor Otwell';
});

ãƒ¼ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä¸€æ™‚ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å…¥åŠ›é…åˆ—ã«æŒ‡å®šã™ã‚‹å€¤ãŒã‚ã‚‹ã‹
$response->assertSessionHasInput($key, $value = null);

ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ã‚’ç¬¬ï¼’å¼•æ•°ã«æ¸¡ã›ã‚‹ï¼ˆã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãŒtrueã‚’è¿”ã›ã°ã‚¢ã‚µãƒ¼ãƒˆã¯æˆåŠŸï¼‰

$response->assertSessionHasInput($key, function ($value) {
    return Crypt::decryptString($value) === 'secret';
});

ãƒ¼ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚­ãƒ¼ï¼å€¤ãƒšã‚¢ã®æŒ‡å®šé…åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
$response->assertSessionHasAll(array $data);

ä¾‹ï¼‰$response->assertSessionHasAll([
    'name' => 'Taylor Otwell',
    'status' => 'active',
]);

ãƒ¼ã€€æŒ‡å®šã™ã‚‹$keysã®ã‚¨ãƒ©ãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
$keysãŒé€£æƒ³é…åˆ—ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(ã‚­ãƒ¼)ã®ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸(å€¤)ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
â€»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’JSONæ§‹é€ ã¨ã—ã¦è¿”ã™ã®ã§ã¯ãªãã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¸€æ™‚ä¿å­˜ã™ã‚‹ãƒ«ãƒ¼ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã¨ãã«ä½¿ç”¨ã™ã‚‹

$response->assertSessionHasErrors(
    array $keys, $format = null, $errorBag = 'default'
);

ä¾‹ï¼‰nameãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨emailãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ä¸€æ™‚ä¿å­˜ã•ã‚ŒãŸæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹
$response->assertSessionHasErrors(['name', 'email']);

$response->assertSessionHasErrors([
    'name' => 'The given name was invalid.'
]);

â—assertInvalidã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒJSONã¨ã—ã¦è¿”ã•ã‚ŒãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’æŒã¤ã‹ã€ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¸€æ™‚ä¿å­˜ã•ã‚ŒãŸã“ã¨ã‚’æ¤œè¨¼ã§ãã‚‹

ãƒ¼ã€€æŒ‡å®šã‚¨ãƒ©ãƒ¼ãƒãƒƒã‚°å†…ã«æŒ‡å®šã™ã‚‹$keysã®ã‚¨ãƒ©ãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹
$keysãŒé€£æƒ³é…åˆ—ã®å ´åˆã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã¯ã‚¨ãƒ©ãƒ¼ãƒãƒƒã‚°å†…ã®å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(ã‚­ãƒ¼)ã«ç‰¹å®šã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸(å€¤)ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’æ¤œè¨¼

$response->assertSessionHasErrorsIn($errorBag, $keys = [], $format = null);

ãƒ¼ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒãªã„
$response->assertSessionHasNoErrors();

ãƒ¼ã€€æŒ‡å®šã™ã‚‹ã‚­ãƒ¼ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãªã„
$response->assertSessionDoesntHaveErrors($keys = [], $format = null, $errorBag = 'default');
â—assertValidã¯ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«JSONå½¢å¼ã§è¿”ã•ã‚ŒãŸçµæœã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒãªãã€ã‹ã¤ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¨ãƒ©ãƒ¼ãŒä¿å­˜ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’æ¤œè¨¼ã™ã‚‹

ãƒ¼ã€€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æŒ‡å®šã™ã‚‹ã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ãªã„
$response->assertSessionMissing($key);
